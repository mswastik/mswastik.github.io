<!DOCTYPE html>
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<script src="js/d3.v3.min.js"></script>
<script src="js/crossfilter.min.js"></script>
<script src="js/dc.min.js"></script>
<script src="js/jquery.min.js"></script>
<script src="js/bootstrap.min.js"></script>
<script src="js/colorbrewer.js"></script>

<link href="css/bootstrap.min.css" rel="stylesheet">
<link href="css/dc.css" rel="stylesheet">
<link href="css/style (2).css" rel="stylesheet">
<link href="css/main.css" rel="stylesheet">
<link href="css/font-awesome.min.css" rel="stylesheet">

<title>Expense Cut</title>
</head>

<nav class="menu" id="theMenu">
		<div class="menu-wrap">
			<h1 class="logo"><a href="index.html#home">HOME</a></h1>
			<i class="fa fa-arrow-right menu-close"></i>
			<a href="index.html">Home</a>
			<a href="dc.html">GSDP of State</a>
			<a href="gvis.html">Google Visualisation</a>
			<a href="stateinvest.html">Statewise Investment Proposal</a>
			<a href="sectorinvest.html">Sectorwise Investment Proposal</a>
			<a href="homeasset.html">2013 Census Home Asset</a>
            <a href="districtcrime.html">Districtwise IPC crimes in 2013</a>
            <a href="statecrop.html">Statewise Crop Production</a>
            <a href="kaggletitanic.html">Kaggle Titanic Data</a>
			<a href="#contact">Contact</a>
			<a href="#"><i class="fa fa-facebook"></i></a>
			<a href="#"><i class="fa fa-twitter"></i></a>
			<a href="#"><i class="fa fa-dribbble"></i></a>
			<a href="#"><i class="fa fa-envelope"></i></a>
		</div>
		
		<!-- Menu button -->
		<div id="menuToggle"><i class="fa fa-bars"></i></div>
</nav>

<div class="container-fluid">
	<div class="row-fluid">
			<div class="col-md-12" id="expbar2"><h1>Description</h1></div>
	</div>
	<div class="row-fluid">
			<div class="col-md-6" id="bar"><h1>Expense</h1></div>
			<div class="col-md-6" id="ring"><h1>Category Cut</h1></div>
	</div>
</div>
<script>
	var parseDate = d3.time.format("%d-%m-%Y").parse;
	var data=d3.csv("data/expense.csv", function(error, data){
		data.forEach(function(d) {
		d.date=parseDate(d.Date);
		d.amt=d3.round(d.Amount);
	});
	var ndx=crossfilter(data);
	var all = ndx.groupAll();
	var timeDim = ndx.dimension(function(d){return d.date;});
	var amt = timeDim.group().reduceSum(dc.pluck('Amount'));
	//Barchart of Proposed Investment
	var invbarchart = dc.barChart("#bar");
	var minDate = timeDim.bottom(1)[0].date;
	var maxDate = timeDim.top(1)[0].date;
	//invbarchart.xUnits(function(){return 1;}); //manually setting bar width
	//var xAxis = invbarchart.xAxis().tickFormat(d3.time.format('%B');
	invbarchart
	.width(550).height(300)
	.dimension(timeDim)
	.group(amt)
	.elasticY(true)
	.elasticX(true)
	.xUnits(function(){return 30;})
	.x(d3.time.scale().domain([minDate,maxDate]))
	.margins({top: 10, left: 80, right: 20, bottom: 60})
	.renderlet(function (chart) {
		            chart.selectAll("g.x text")
	                    .attr('dx', '-30')
	                    .attr('dy', '-1')
	                    .attr('transform', "rotate(-50)");
	               });
	//Rowchart of Statewise split
	var stateDim = ndx.dimension(function(d){return d.Description;});
	var stat_tot = stateDim.group().reduceSum(function(d) { return d.amt; });
	var statebar = dc.barChart("#expbar2");
	statebar
	.margins({ top: -15, left: 40, right: 0, bottom: 10})
	.width(1200).height(300)
	.dimension(stateDim)
	.transitionDuration(500)
	.group(stat_tot)
	.x(d3.scale.ordinal())
	.xUnits(dc.units.ordinal)
	.ordering(function(d){return -d.value;})
	.elasticY(true)
	.elasticX(true)
	.turnOnControls()
	.colors('purple')
	.renderlet(function (chart) {
	            chart.selectAll("g.x text")
	                 .attr('dx', '20')
	                 .attr('dy', '-8')
	                 .attr('transform', "rotate(-90)");
	            });
	//Category Percent
	var gdpbarchart = dc.pieChart("#ring");
	var sectorDim = ndx.dimension(function(d){return d.Category;});
	var nos = sectorDim.group().reduceSum(dc.pluck('Amount'));
	gdpbarchart
	.width(300).height(300)
	.dimension(sectorDim)
	.group(nos)
	.innerRadius(30)
  	.legend(dc.legend().x(300).y(50).gap(15))
	.label(function(d) {
		 return d3.round((d.value / d3.sum(nos.all(), function(d){ return d.value;}))*100)+"%";})
	.renderLabel(true)
	.turnOnControls();
	
	dc.renderAll();
});
</script>
<script src="js/main.js"></script>
